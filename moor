#!/bin/bash

IMAGE=$1
TAG=$2
NAME=$3
CMD=$4

# Host
BIN=~/.local/bin
MOORHOME=.moor/home
mkdir -p $HOME/$MOORHOME

# Container
WORKDIR=/workdir

printf \
'GID=$(id -g $USER)

docker run -i --rm \
--network=host \
--ipc=host \
--workdir '$WORKDIR' \
--volume $PWD:'$WORKDIR' \
--volume $HOME/'$MOORHOME':$HOME \
--user $UID:$GID \
--env HOME=$HOME \
'$IMAGE':'$TAG' \
'$CMD' \
"$@"

' > $BIN/$NAME && chmod +x $BIN/$NAME
